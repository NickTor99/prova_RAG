{"vulnerability":"Unchecked_Payment_Receiver","smart_contract":"from pyteal import *\n\ndef pension_system():\n    company_key = Bytes(\"Company\")\n    fund_key = Bytes(\"Fund\")\n    pension_key = Bytes(\"Pension\")\n    \n    init = Seq([\n        App.globalPut(company_key, Txn.sender()),\n        App.globalPut(fund_key, Int(0)),\n        Return(Int(1))\n    ])\n    \n    contribute = Seq([\n        Assert(Txn.sender() == App.globalGet(company_key)),\n        App.globalPut(fund_key, App.globalGet(fund_key) + Txn.amount()),\n        Approve()\n    ])\n    \n    set_pension = Seq([\n        Assert(Txn.sender() == App.globalGet(company_key)),\n        App.globalPut(pension_key, Btoi(Txn.application_args[1])),\n        Approve()\n    ])\n\n    handledelete = Seq([\n        Assert(Txn.sender() == App.globalGet(company_key)),\n        Approve()\n    ])\n    \n    withdraw = Seq([\n        Assert(Global.group_size() == Int(2)),\n        Assert(Gtxn[0].sender() == App.globalGet(company_key)),\n        Assert(App.globalGet(fund_key) >= App.globalGet(pension_key)),\n        App.globalPut(fund_key, App.globalGet(fund_key) - App.globalGet(pension_key)),\n        InnerTxnBuilder.Begin(),\n        InnerTxnBuilder.SetField(TxnField.type_enum, TxnType.Payment),\n        InnerTxnBuilder.SetField(TxnField.amount, App.globalGet(pension_key)),\n        InnerTxnBuilder.SetField(TxnField.receiver, Gtxn[1].receiver()),\n        InnerTxnBuilder.Submit(),\n        Approve()\n    ])\n    \n    program = Cond(\n        [Txn.application_id() == Int(0), init],\n        [Txn.on_completion() == OnComplete.NoOp, contribute],\n        [Txn.on_completion() == OnComplete.UpdateApplication, set_pension],\n        [Txn.on_completion() == OnComplete.DeleteApplication, handledelete],\n        [Txn.on_completion() == OnComplete.CloseOut, Return(Int(1))],\n        [Txn.on_completion() == OnComplete.OptIn, withdraw]\n    )\n    \n    return program\n\ndef clear_state():\n    return Return(Int(1))\n\nif __name__ == \"__main__\":\n    print(compileTeal(pension_system(), mode=Mode.Application, version=5))\n\n"}
